{# templates/edit.html #}
{% extends "base.html" %}
{% block content %}

  <div class="flex items-center justify-between">
	<h1 class="text-base font-medium">{{ "New block" if is_new else "Edit block" }}</h1>
	<a href="/flow/{{ block.get('flow','') }}" class="text-sm" style="color:var(--muted2);">
	  <i class="fa-solid fa-arrow-left" style="font-size:11px"></i> back
	</a>
  </div>

  {% if error %}
	<div class="mt-4 rounded-2xl p-3 text-sm" style="border:1px solid var(--dangerBorder);background:var(--dangerBg);color:var(--dangerFg);">
	  {{ error }}
	</div>
  {% endif %}

  <form class="mt-6 space-y-4" method="post" action="/block/save" enctype="multipart/form-data">
	<input type="hidden" name="block_id" value="{{ block.get('id', 0) }}" />
	<input type="hidden" name="file_path" value="{{ block.get('file_path','') }}" />
	<input type="hidden" name="file_kind" value="{{ block.get('file_kind','') }}" />
	<input type="hidden" name="file_name" value="{{ block.get('file_name','') }}" />
	<input type="hidden" id="delaySeconds" name="delay_seconds" value="{{ block.get('delay', 1.0) }}" />

	<div class="grid grid-cols-1 md:grid-cols-3 gap-3">
	  <div>
		<label class="text-xs" style="color:var(--muted2)">flow</label>
		<input
		  name="flow"
		  value="{{ block.get('flow','') }}"
		  class="w-full mt-1 px-3 py-2 rounded-xl"
		  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		/>
	  </div>
	  <div>
		<label class="text-xs" style="color:var(--muted2)">position</label>
		<input
		  name="position"
		  type="number"
		  value="{{ block.get('position', 1) }}"
		  class="w-full mt-1 px-3 py-2 rounded-xl"
		  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		/>
	  </div>
	  <div>
		<label class="text-xs" style="color:var(--muted2)">type</label>
		<select
		  id="typeSel"
		  name="type"
		  class="w-full mt-1 px-3 py-2 rounded-xl"
		  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		>
		  {% set cur_type = block.get('type','text') %}
		  {% for t in ["text","circle","video","buttons"] %}
			<option value="{{ t }}" {% if cur_type == t %}selected{% endif %}>{{ t }}</option>
		  {% endfor %}
		</select>
	  </div>
	</div>

	<div class="grid grid-cols-1 md:grid-cols-3 gap-3">
	  <div>
		<label class="text-xs" style="color:var(--muted2)">title (–¥–ª—è video/buttons)</label>
		<input
		  name="title"
		  value="{{ block.get('title','') }}"
		  class="w-full mt-1 px-3 py-2 rounded-xl"
		  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		/>
	  </div>
	  <div>
		<label class="text-xs" style="color:var(--muted2)">delay</label>
		<div class="text-[11px]" style="color:var(--muted2);margin-top:-2px;">–º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –º–∏–Ω—É—Ç—ã/—á–∞—Å—ã/–¥–Ω–∏ (–≤ –±–∞–∑—É —É–π–¥—ë—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö)</div>
		<div class="mt-1 flex items-center gap-2">
		  <input
			id="delayValue"
			type="number"
			min="0"
			step="1"
			value=""
			class="w-24 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			placeholder="1"
		  />
		  <select
			id="delayUnit"
			class="px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		  >
			<option value="seconds">seconds</option>
			<option value="minutes">minutes</option>
			<option value="hours">hours</option>
			<option value="days">days</option>
		  </select>
		  <button
			type="button"
			class="px-3 py-2 rounded-xl text-sm"
			style="background:var(--btnBg);border:1px solid var(--btnBorder);color:var(--fg);"
			onclick="applyDelayToSeconds()"
			title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å delay ‚Üí delay_seconds"
		  >
			Apply
		  </button>
		</div>
		<div class="mt-2 text-[11px]" style="color:var(--muted2);">
		  –°–µ–π—á–∞—Å: <span style="color:var(--fg);"><code id="delaySecondsPreview">{{ block.get('delay', 1.0) }}</code> sec</span>
		</div>
	  </div>
	  <div>
		<label class="text-xs" style="color:var(--muted2)">is_active (0/1)</label>
		<input
		  name="is_active"
		  type="number"
		  value="{{ block.get('is_active', 1) }}"
		  class="w-full mt-1 px-3 py-2 rounded-xl"
		  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		/>
	  </div>
	</div>

	<!-- TEXT -->
	<div id="secText">
	  <label class="text-xs" style="color:var(--muted2)">text</label>
	  <textarea
		name="text"
		rows="6"
		class="w-full mt-1 px-3 py-2 rounded-xl"
		style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
	  >{{ block.get('text','') }}</textarea>
	</div>

	<!-- MEDIA -->
	<div class="grid grid-cols-1 md:grid-cols-2 gap-3" id="secMedia">
	  <div>
		<label class="text-xs" style="color:var(--muted2)">circle_path (–∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª)</label>
		<input
		  name="circle_path"
		  value="{{ block.get('circle','') }}"
		  class="w-full mt-1 px-3 py-2 rounded-xl"
		  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		/>
		<div class="mt-2">
		  <input type="file" name="circle_file" class="text-sm" style="color:var(--muted);" />
		</div>
		{% if block.get('circle') %}
		  <div class="mt-2 text-[11px]" style="color:var(--muted2);">current: {{ block.get('circle') }}</div>
		{% endif %}
	  </div>
	  <div>
		<label class="text-xs" style="color:var(--muted2)">video_url</label>
		<input
		  name="video_url"
		  value="{{ block.get('video','') }}"
		  class="w-full mt-1 px-3 py-2 rounded-xl"
		  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		/>
	  </div>
	</div>

	<!-- ATTACHMENT -->
	<div class="rounded-2xl p-4" style="border:1px solid var(--border);background:var(--panel2);">
	  <div class="flex items-center justify-between mb-3">
		<div class="text-sm font-medium">
		  <i class="fa-solid fa-paperclip" style="font-size:12px;color:var(--muted);margin-right:6px;"></i>Attachment
		</div>
		<div class="text-xs" style="color:var(--muted2);">–ª—é–±–æ–π —Ñ–∞–π–ª (pdf/docx/png/zip –∏ —Ç.–¥.)</div>
	  </div>
	  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
		<div>
		  <label class="text-xs" style="color:var(--muted2)">upload file</label>
		  <input type="file" name="attach_file" class="block mt-2 text-sm" style="color:var(--muted);" />
		  <div class="text-[11px] mt-2" style="color:var(--muted2);">
			–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∏—à—å ‚Äî —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ <code>media/</code> –∏ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –±–æ—Ç–æ–º –≤ —ç—Ç–æ–º –±–ª–æ–∫–µ.
		  </div>
		</div>
		<div>
		  <label class="text-xs" style="color:var(--muted2)">current</label>
		  <div class="mt-2 text-sm">
			{% if block.get('file_path') %}
			  <div class="text-[11px]" style="color:var(--muted2);">kind: {{ block.get('file_kind','') }}</div>
			  <a style="color:var(--fg);text-decoration:underline;" href="{{ block.get('file_path') }}" target="_blank">{{ block.get('file_path') }}</a>
			{% else %}
			  <span style="color:var(--muted2);">‚Äî</span>
			{% endif %}
		  </div>
		  <div class="mt-3">
			<button
			  type="button"
			  class="px-3 py-2 rounded-xl text-sm"
			  style="background:var(--btnBg);border:1px solid var(--btnBorder);color:var(--fg);"
			  onclick="clearAttachment()"
			>
			  <i class="fa-solid fa-xmark" style="font-size:11px;margin-right:4px;"></i>Clear attachment
			</button>
		  </div>
		</div>
	  </div>
	</div>

	<!-- NEXT LESSON GATE -->
	<div class="rounded-2xl p-4" style="border:1px solid var(--border);background:var(--panel2);">
	  <div class="flex items-center justify-between mb-3">
		<div class="text-sm font-medium">
		  <i class="fa-solid fa-door-open" style="font-size:12px;color:var(--muted);margin-right:6px;"></i>Next lesson gate
		</div>
		<div class="text-xs" style="color:var(--muted2);">–∫–Ω–æ–ø–∫–∞ "–ì–æ—Ç–æ–≤‚Ä¶" + –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</div>
	  </div>
	  <div class="text-[11px] mb-4" style="color:var(--muted2);">
		–ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å <b>Next flow</b> ‚Äî –±–æ—Ç –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏ –ø–æ–∫–∞–∂–µ—Ç –∫–Ω–æ–ø–∫—É.
		–ü–æ –Ω–∞–∂–∞—Ç–∏—é ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–π flow.
	  </div>
	  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Next flow (—á—Ç–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ—Å–ª–µ –∫–Ω–æ–ø–∫–∏)</label>
		  {% if flows is defined and flows %}
			<select
			  name="gate_next_flow"
			  class="w-full mt-1 px-3 py-2 rounded-xl"
			  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			>
			  <option value="">‚Äî disabled ‚Äî</option>
			  {% for f in flows %}
				<option value="{{ f }}" {% if block.get('gate_next_flow','') == f %}selected{% endif %}>{{ f }}</option>
			  {% endfor %}
			</select>
		  {% else %}
			<input
			  name="gate_next_flow"
			  value="{{ block.get('gate_next_flow','') }}"
			  class="w-full mt-1 px-3 py-2 rounded-xl"
			  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			  placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: day2"
			/>
			<div class="text-[11px] mt-1" style="color:var(--muted2);">
			  (—á—Ç–æ–±—ã –±—ã–ª dropdown ‚Äî –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å <code>flows</code> –≤ —à–∞–±–ª–æ–Ω –∏–∑ crm.py)
			</div>
		  {% endif %}
		</div>
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Button text</label>
		  <input
			name="gate_button_text"
			value="{{ block.get('gate_button_text') or '‚úÖ –ì–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É' }}"
			class="w-full mt-1 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		  />
		</div>
	  </div>
	  <div class="mt-3">
		<label class="text-xs" style="color:var(--muted2)">Text above button (editable)</label>
		<input
		  name="gate_prompt_text"
		  value="{{ block.get('gate_prompt_text','') }}"
		  class="w-full mt-1 px-3 py-2 rounded-xl"
		  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		  placeholder="üëá –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –¥–∞–ª—å—à–µ"
		/>
		<div class="text-[11px] mt-1" style="color:var(--muted2);">
		  –ï—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç.
		</div>
	  </div>
	  <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-3">
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Reminder</label>
		  <input
			name="gate_reminder_value"
			type="number"
			min="0"
			value="{{ block.get('gate_reminder_value', 0) }}"
			class="w-full mt-1 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			placeholder="0"
		  />
		  <div class="text-[11px] mt-1" style="color:var(--muted2);">0 = –±–µ–∑ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</div>
		</div>
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Unit</label>
		  {% set u = (block.get('gate_reminder_unit') or 'hours') %}
		  <select
			name="gate_reminder_unit"
			class="w-full mt-1 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		  >
			<option value="minutes" {% if u=='minutes' %}selected{% endif %}>minutes</option>
			<option value="hours" {% if u=='hours' %}selected{% endif %}>hours</option>
			<option value="days" {% if u=='days' %}selected{% endif %}>days</option>
		  </select>
		</div>
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Reminder text (optional)</label>
		  <input
			name="gate_reminder_text"
			value="{{ block.get('gate_reminder_text','') }}"
			class="w-full mt-1 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢—ã –≥–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å? üôÇ"
		  />
		</div>
	  </div>
	  <div class="mt-3 flex items-center gap-3">
		<button
		  type="button"
		  class="px-3 py-2 rounded-xl text-sm"
		  style="background:var(--btnBg);border:1px solid var(--btnBorder);color:var(--fg);"
		  onclick="clearGate()"
		>
		  <i class="fa-solid fa-ban" style="font-size:11px;margin-right:4px;"></i>Disable gate
		</button>
		<div class="text-[11px]" style="color:var(--muted2);">
		  Disabled = –ø–æ–ª–µ Next flow —Å—Ç–∞–Ω–µ—Ç –ø—É—Å—Ç—ã–º (gate –≤—ã–∫–ª—é—á–µ–Ω).
		</div>
	  </div>
	</div>

	<!-- BUTTONS EASY MODE -->
	<div id="secButtons" class="rounded-2xl p-4" style="border:1px solid var(--border);background:var(--panel2);">
	  <div class="flex items-center justify-between mb-3">
		<div class="text-sm font-medium">
		  <i class="fa-solid fa-grip" style="font-size:12px;color:var(--muted);margin-right:6px;"></i>Buttons
		</div>
		<div class="text-xs" style="color:var(--muted2);">–¥–æ 3 –∫–Ω–æ–ø–æ–∫</div>
	  </div>
	  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Button 1 text</label>
		  <input
			name="btn1_text"
			value="{{ block.get('btn1_text','') }}"
			class="w-full mt-1 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç"
		  />
		</div>
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Button 1 url</label>
		  <input
			name="btn1_url"
			value="{{ block.get('btn1_url','') }}"
			class="w-full mt-1 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			placeholder="https://..."
		  />
		</div>
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Button 2 text</label>
		  <input
			name="btn2_text"
			value="{{ block.get('btn2_text','') }}"
			class="w-full mt-1 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			placeholder="(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
		  />
		</div>
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Button 2 url</label>
		  <input
			name="btn2_url"
			value="{{ block.get('btn2_url','') }}"
			class="w-full mt-1 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			placeholder="https://..."
		  />
		</div>
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Button 3 text</label>
		  <input
			name="btn3_text"
			value="{{ block.get('btn3_text','') }}"
			class="w-full mt-1 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			placeholder="(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
		  />
		</div>
		<div>
		  <label class="text-xs" style="color:var(--muted2)">Button 3 url</label>
		  <input
			name="btn3_url"
			value="{{ block.get('btn3_url','') }}"
			class="w-full mt-1 px-3 py-2 rounded-xl"
			style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
			placeholder="https://..."
		  />
		</div>
	  </div>
	  <details class="mt-4">
		<summary class="text-xs cursor-pointer" style="color:var(--muted2);">Advanced (JSON)</summary>
		<textarea
		  name="buttons_json"
		  rows="4"
		  class="w-full mt-2 px-3 py-2 rounded-xl"
		  style="background:var(--inputBg);border:1px solid var(--inputBorder);color:var(--fg);"
		>{{ block.get('buttons_json','') or block.get('buttons','') }}</textarea>
		<div class="text-[11px] mt-1" style="color:var(--muted2);">
		  –ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ ‚Äî –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω JSON. –ò–Ω–∞—á–µ –±–µ—Ä—ë–º –∫–Ω–æ–ø–∫–∏ —Å–≤–µ—Ä—Ö—É.
		</div>
	  </details>
	</div>

	<button class="px-4 py-2 rounded-xl text-sm font-medium" style="background:var(--primaryBg);color:var(--primaryFg);border:none;">
	  <i class="fa-solid fa-floppy-disk" style="font-size:12px;margin-right:6px;"></i>Save
	</button>
  </form>

  <script>
	function toggleSections() {
	  const secButtons = document.getElementById("secButtons");
	  if (secButtons) {
		secButtons.style.display = "block";
		secButtons.style.opacity = "1";
		secButtons.style.pointerEvents = "auto";
		secButtons.querySelectorAll("input, textarea").forEach(i => i.disabled = false);
	  }
	}
	function clearAttachment() {
	  const fp = document.querySelector('input[name="file_path"]');
	  const fk = document.querySelector('input[name="file_kind"]');
	  const fn = document.querySelector('input[name="file_name"]');
	  if (fp) fp.value = '';
	  if (fk) fk.value = '';
	  if (fn) fn.value = '';
	  alert('Attachment –æ—á–∏—â–µ–Ω. –ù–∞–∂–º–∏ Save.');
	}
	function clearGate() {
	  const nf = document.querySelector('[name="gate_next_flow"]');
	  const bt = document.querySelector('[name="gate_button_text"]');
	  const gp = document.querySelector('[name="gate_prompt_text"]');
	  const rv = document.querySelector('[name="gate_reminder_value"]');
	  const ru = document.querySelector('[name="gate_reminder_unit"]');
	  const rt = document.querySelector('[name="gate_reminder_text"]');
	  if (nf) nf.value = '';
	  if (bt) bt.value = '';
	  if (gp) gp.value = '';
	  if (rv) rv.value = '0';
	  if (ru) ru.value = 'hours';
	  if (rt) rt.value = '';
	  alert('Gate –æ—Ç–∫–ª—é—á—ë–Ω. –ù–∞–∂–º–∏ Save.');
	}
	function unitToSeconds(unit) {
	  const u = (unit || '').toLowerCase();
	  if (u === 'minutes') return 60;
	  if (u === 'hours') return 3600;
	  if (u === 'days') return 86400;
	  return 1;
	}
	function secondsToValueUnit(sec) {
	  const s = Math.max(0, Math.floor(Number(sec || 0)));
	  if (s === 0) return { value: 0, unit: 'seconds' };
	  if (s % 86400 === 0) return { value: s / 86400, unit: 'days' };
	  if (s % 3600 === 0) return { value: s / 3600, unit: 'hours' };
	  if (s % 60 === 0) return { value: s / 60, unit: 'minutes' };
	  return { value: s, unit: 'seconds' };
	}
	function applyDelayToSeconds() {
	  const vEl = document.getElementById('delayValue');
	  const uEl = document.getElementById('delayUnit');
	  const sEl = document.getElementById('delaySeconds');
	  const pEl = document.getElementById('delaySecondsPreview');
	  const v = Math.max(0, Math.floor(Number((vEl && vEl.value) || 0)));
	  const u = (uEl && uEl.value) || 'seconds';
	  const sec = v * unitToSeconds(u);
	  if (sEl) sEl.value = String(sec);
	  if (pEl) pEl.textContent = String(sec);
	}
	function initDelayUI() {
	  const sEl = document.getElementById('delaySeconds');
	  const vEl = document.getElementById('delayValue');
	  const uEl = document.getElementById('delayUnit');
	  const pEl = document.getElementById('delaySecondsPreview');
	  const sec = Number((sEl && sEl.value) || 0);
	  const vu = secondsToValueUnit(sec);
	  if (vEl) vEl.value = String(vu.value);
	  if (uEl) uEl.value = vu.unit;
	  if (pEl) pEl.textContent = String(Math.max(0, Math.floor(sec)));
	}
	document.addEventListener('DOMContentLoaded', () => {
	  const typeSel = document.getElementById("typeSel");
	  if (typeSel) typeSel.addEventListener("change", toggleSections);
	  toggleSections();
	  initDelayUI();
	  const vEl = document.getElementById('delayValue');
	  const uEl = document.getElementById('delayUnit');
	  if (vEl) vEl.addEventListener('input', applyDelayToSeconds);
	  if (uEl) uEl.addEventListener('change', applyDelayToSeconds);
	});
  </script>

{% endblock %}
